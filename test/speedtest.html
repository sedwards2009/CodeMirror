<!doctype html>

<meta charset="utf-8"/>
<title>CodeMirror: Speed Test</title>
<link rel=stylesheet href="../doc/docs.css">

<link rel="stylesheet" href="../lib/codemirror.css">
<link rel="stylesheet" href="mode_test.css">
<script src="../doc/activebookmark.js"></script>
<script src="../lib/codemirror.js"></script>
<script src="../mode/meta.js"></script>
<script src="../addon/mode/overlay.js"></script>
<script src="../addon/mode/multiplex.js"></script>
<script src="../addon/search/searchcursor.js"></script>
<script src="../addon/dialog/dialog.js"></script>
<script src="../addon/edit/matchbrackets.js"></script>
<script src="../addon/hint/sql-hint.js"></script>
<script src="../addon/comment/comment.js"></script>
<script src="../addon/mode/simple.js"></script>
<script src="../mode/css/css.js"></script>
<script src="../mode/clike/clike.js"></script>
<!-- clike must be after css or vim and sublime tests will fail -->
<script src="../mode/gfm/gfm.js"></script>
<script src="../mode/haml/haml.js"></script>
<script src="../mode/htmlmixed/htmlmixed.js"></script>
<script src="../mode/javascript/javascript.js"></script>
<script src="../mode/jsx/jsx.js"></script>
<script src="../mode/markdown/markdown.js"></script>
<script src="../mode/php/php.js"></script>
<script src="../mode/python/python.js"></script>
<script src="../mode/powershell/powershell.js"></script>
<script src="../mode/ruby/ruby.js"></script>
<script src="../mode/shell/shell.js"></script>
<script src="../mode/slim/slim.js"></script>
<script src="../mode/sql/sql.js"></script>
<script src="../mode/stex/stex.js"></script>
<script src="../mode/textile/textile.js"></script>
<script src="../mode/verilog/verilog.js"></script>
<script src="../mode/xml/xml.js"></script>
<script src="../mode/xquery/xquery.js"></script>
<script src="../keymap/emacs.js"></script>
<script src="../keymap/sublime.js"></script>
<script src="../keymap/vim.js"></script>
<script src="../mode/rust/rust.js"></script>
<script src="../mode/mscgen/mscgen.js"></script>
<script src="../mode/dylan/dylan.js"></script>

<style type="text/css">
  .CodeMirror { border: 1px solid black; height: 100%;}
  .cm_container {
    width: 500px;
    height: 200px;
    contain: strict;
  }
</style>

<div id=nav>
  <a href="http://codemirror.net"><h1>CodeMirror</h1><img id=logo src="../doc/logo.png"></a>

  <ul>
    <li><a href="../index.html">Home</a>
    <li><a href="../doc/manual.html">Manual</a>
    <li><a href="https://github.com/codemirror/codemirror">Code</a>
  </ul>
  <ul>
    <li><a class=active href="#">Test suite</a>
  </ul>
</div>

<article>
  <h2>Speed Test</h2>

    <p>A test harness for doing optimization work for CodeMirror.</p>

    <button id="refresh_old">Refresh Old</button>
    <button id="refresh">Refresh Coordinated</button>
    <button id="set_size_old">Old setSize()</button>
    <button id="set_size">setSize()</button>

    <div id="testground"></div>

    <script src="driver.js"></script>
    <script src="test.js"></script>
    <script src="doc_test.js"></script>
    <script src="multi_test.js"></script>
    <script src="scroll_test.js"></script>
    <script src="comment_test.js"></script>
    <script src="search_test.js"></script>
    <script src="mode_test.js"></script>

    <script src="../mode/clike/test.js"></script>
    <script src="../mode/css/test.js"></script>
    <script src="../mode/css/gss_test.js"></script>
    <script src="../mode/css/scss_test.js"></script>
    <script src="../mode/css/less_test.js"></script>
    <script src="../mode/gfm/test.js"></script>
    <script src="../mode/haml/test.js"></script>
    <script src="../mode/javascript/test.js"></script>
    <script src="../mode/jsx/test.js"></script>
    <script src="../mode/markdown/test.js"></script>
    <script src="../mode/php/test.js"></script>
    <script src="../mode/powershell/test.js"></script>
    <script src="../mode/ruby/test.js"></script>
    <script src="../mode/shell/test.js"></script>
    <script src="../mode/slim/test.js"></script>
    <script src="../mode/stex/test.js"></script>
    <script src="../mode/textile/test.js"></script>
    <script src="../mode/verilog/test.js"></script>
    <script src="../mode/xml/test.js"></script>
    <script src="../mode/xquery/test.js"></script>
    <script src="../mode/python/test.js"></script>
    <script src="../mode/rust/test.js"></script>
    <script src="../mode/mscgen/mscgen_test.js"></script>
    <script src="../mode/mscgen/xu_test.js"></script>
    <script src="../mode/mscgen/msgenny_test.js"></script>
    <script src="../mode/dylan/test.js"></script>
    <script src="../addon/mode/multiplex_test.js"></script>
    <script>
window.onload = startUp;

let editors = null;

function startUp() {
  const EDITOR_COUNT = 100;

  editors  = [];
  for (let i=0; i<EDITOR_COUNT; i++) {
   editors.push(appendEditor("editor" + i));
  }

  document.getElementById("refresh").addEventListener('click', () => {
    const asyncFuncs = editors.map( ed => {
      return ed.coordinatedOperation( () => {
        ed.refresh();
      });
    } );
    let done = false;
    while ( ! done) {
      done = true;
      for (let i=0; i<asyncFuncs.length; i++) {
        done = asyncFuncs[i]() && done;
      }
    }
  });

  document.getElementById("refresh_old").addEventListener('click', () => {
    editors.forEach( ed => ed.refresh() );
  });

  document.getElementById("set_size_old").addEventListener('click', () => {
    editors.forEach( ed => ed.setSize(null, null) );
  });

  document.getElementById("set_size").addEventListener('click', () => {
    const asyncFuncs = editors.map( ed => {
      return ed.coordinatedOperation( () => {
        ed.setSize(null, null);
      });
    } );
    let done = false;
    while ( ! done) {
      done = true;
      for (let i=0; i<asyncFuncs.length; i++) {
        done = asyncFuncs[i]() && done;
      }
    }
  });

}

function appendEditor(name) {
  const testGround = document.getElementById("testground");
  const newDiv = document.createElement("div");
  newDiv.id = name;
  newDiv.classList.add("cm_container");
  testGround.appendChild(newDiv);

  const editor = CodeMirror(newDiv, {
    //lineNumbers: true,
    lineWrapping: false
  });
  editor.getDoc().setValue(
`Entire any had depend and figure winter. Change stairs and men likely wisdom new happen piqued six.
Now taken him timed sex world get. Enjoyed married an feeling delight pursuit as offered.
As admire roused length likely played pretty to no. Means had joy miles her merry solid order. 

Their could can widen ten she any. As so we smart those money in.
Am wrote up whole so tears sense oh. Absolute required of reserved in offering no.
How sense found our those gay again taken the. Had mrs outweigh desirous sex overcame. Improved property reserved disposal do offering me. 

Both rest of know draw fond post as.
It agreement defective to excellent. Feebly do engage of narrow.
Extensive repulsive belonging depending if promotion be zealously as.
Preference inquietude ask now are dispatched led appearance.
Small meant in so doubt hopes. Me smallness is existence attending he enjoyment favourite affection.
Delivered is to ye belonging enjoyment preferred. Astonished and acceptance men two discretion.
Law education recommend did objection how old. 

Ye on properly handsome returned throwing am no whatever.
In without wishing he of picture no exposed talking minutes.
Curiosity continual belonging offending so explained it exquisite.
Do remember to followed yourself material mr recurred carriage.
High drew west we no or at john.
About or given on witty event.
Or sociable up material bachelor bringing landlord confined.
Busy so many in hung easy find well up.
So of exquisite my an explained remainder.
Dashwood denoting securing be on perceive my laughing so.
`);
  return editor;
}
    </script>

</article>
